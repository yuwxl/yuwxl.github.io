

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/dog.jpg">
  <link rel="icon" href="/img/dog.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="nayun">
  <meta name="keywords" content="">
  
    <meta name="description" content="layer2 top项目https:&#x2F;&#x2F;l2beat.com&#x2F;scaling&#x2F;tvl?view&#x3D;risk  layer2扩容方案layer2 二层解决方案：基本想法是链下计算&#x2F;执行，结果上链；离线批量处理。直接从第一层以太坊共识中获得安全性。 不同的layer2方案 会在安全性、扩容效率、去中心化程度、通用性之间寻找平衡。 LD Research：一文详解以太坊扩容全方案 侧链侧链通常是选择牺牲了">
<meta property="og:type" content="article">
<meta property="og:title" content="layer2_sum">
<meta property="og:url" content="https://yuwxl.github.io/2023/04/25/layer2-sum/index.html">
<meta property="og:site_name" content="yu&#39;s blog">
<meta property="og:description" content="layer2 top项目https:&#x2F;&#x2F;l2beat.com&#x2F;scaling&#x2F;tvl?view&#x3D;risk  layer2扩容方案layer2 二层解决方案：基本想法是链下计算&#x2F;执行，结果上链；离线批量处理。直接从第一层以太坊共识中获得安全性。 不同的layer2方案 会在安全性、扩容效率、去中心化程度、通用性之间寻找平衡。 LD Research：一文详解以太坊扩容全方案 侧链侧链通常是选择牺牲了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622184644000.png">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-cba9ed08a4e1b5481471c30b55b7bcfc_720w.webp">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622100305206.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622100457107.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622100941551.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622102719216.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622104053148.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622104542137.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622110210365.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622110349902.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622144105314.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622145415842.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622145659105.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602144922178.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602145001327.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602145156549.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602145347083.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602145845986.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602150431099.png">
<meta property="og:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230602150616688.png">
<meta property="og:image" content="https://vitalik.ca/images/rollup-files/diag1.png">
<meta property="og:image" content="https://vitalik.ca/images/rollup-files/diag2.png">
<meta property="og:image" content="https://vitalik.ca/images/rollup-files/tree.png">
<meta property="article:published_time" content="2023-04-25T11:05:54.000Z">
<meta property="article:modified_time" content="2023-06-28T06:45:38.000Z">
<meta property="article:author" content="nayun">
<meta property="article:tag" content="summary">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://yuwxl.github.io/images/layer2-sum/image-20230622184644000.png">
  
  
  
  <title>layer2_sum - yu&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yuwxl.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>nana</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/tina.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="layer2_sum"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-25 19:05" pubdate>
          2023年4月25日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          92 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">layer2_sum</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="layer2-top项目"><a href="#layer2-top项目" class="headerlink" title="layer2 top项目"></a>layer2 top项目</h2><p><a target="_blank" rel="noopener" href="https://l2beat.com/scaling/tvl?view=risk">https://l2beat.com/scaling/tvl?view=risk</a></p>
<p><img src="/images/layer2-sum/image-20230622184644000.png" srcset="/img/loading.gif" lazyload alt="image-20230622184644000"></p>
<h2 id="layer2扩容方案"><a href="#layer2扩容方案" class="headerlink" title="layer2扩容方案"></a>layer2扩容方案</h2><p>layer2 二层解决方案：基本想法是链下计算/执行，结果上链；离线批量处理。直接从第一层以太坊共识中获得安全性。</p>
<p>不同的layer2方案 会在安全性、扩容效率、去中心化程度、通用性之间寻找平衡。</p>
<p><a target="_blank" rel="noopener" href="https://www.odaily.news/post/5182589">LD Research：一文详解以太坊扩容全方案</a></p>
<h4 id="侧链"><a href="#侧链" class="headerlink" title="侧链"></a>侧链</h4><p>侧链通常是选择牺牲了一些去中心化或安全性来实现高吞吐量。</p>
<blockquote>
<p>侧链主要是通过双向锚定的跨链桥（two way pegged cross chain bridge）来实现与主网的链接、以及互相操作（这个概念我们很快就会细说）。而这里所谓的双向锚定式主要是指支持资产的双向锚定，即资产在主链与侧链之间的互转。不过这里需要注意一下，实际上资产并非实现真正意义上的转移，只是通过”一条链锁定，另一条链铸造相同面额资产“的方式来进行”跨链“。但凡是架设双向锚定跨链桥的项目都可以被视为侧链。</p>
</blockquote>
<h3 id="理解以太坊的Layer-2扩容解决方案：状态通道（State-Channels）、Plasma-和-Truebit"><a href="#理解以太坊的Layer-2扩容解决方案：状态通道（State-Channels）、Plasma-和-Truebit" class="headerlink" title="理解以太坊的Layer 2扩容解决方案：状态通道（State Channels）、Plasma 和 Truebit"></a><a target="_blank" rel="noopener" href="https://www.bcskill.com/index.php/archives/965.html">理解以太坊的Layer 2扩容解决方案：状态通道（State Channels）、Plasma 和 Truebit</a></h3><h4 id="状态通道"><a href="#状态通道" class="headerlink" title="状态通道"></a>状态通道</h4><p><a target="_blank" rel="noopener" href="https://www.nichanank.com/blog/2018/9/27/scalability-pt-2-state-channels-counterfactual-instantiation"><strong>Scalability pt 2: State Channels &amp; Counterfactual Instantiation</strong></a></p>
<h2 id="Rollup"><a href="#Rollup" class="headerlink" title="Rollup"></a>Rollup</h2><p><a target="_blank" rel="noopener" href="https://medium.com/cortexlabs/%E4%B8%80%E6%96%87%E8%AF%BB%E6%87%82%E4%BB%80%E4%B9%88%E6%98%AFzk-rollup-8c0200a4dfab">一文读懂什么是ZK-Rollup?</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/551777466">https://zhuanlan.zhihu.com/p/551777466</a></p>
<p>(推荐)<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/GT4Yfw8VPhBikME4mKCTNQ">https://mp.weixin.qq.com/s/GT4Yfw8VPhBikME4mKCTNQ</a></p>
<p>Rollup方案目前的代表项目主要有Polygon、Arbitrum、StarkEx、Optimism、zkSync、Aztec、StarkNet等。</p>
<p><img src="https://pic1.zhimg.com/80/v2-cba9ed08a4e1b5481471c30b55b7bcfc_720w.webp" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="/images/layer2-sum/image-20230622100305206.png" srcset="/img/loading.gif" lazyload alt="image-20230622100305206"></p>
<p><img src="/images/layer2-sum/image-20230622100457107.png" srcset="/img/loading.gif" lazyload alt="image-20230622100457107"></p>
<blockquote>
<p>以太坊达成共识过程？？</p>
</blockquote>
<p><img src="/images/layer2-sum/image-20230622100941551.png" srcset="/img/loading.gif" lazyload alt="image-20230622100941551"></p>
<blockquote>
<p>State Channel : 用户首先将资金锁在主链的智能合约中，在layer2上复制出相应的资产，在layer2上进行各种交易，不占用主链资源，直到参与方都同意结束交易，state Channel将交易终止信息发回layer1,layer1根据交易结果完成资产分配。</p>
<p>Plasma ：向主链发送的内容为初始和结束的状态根</p>
<p>以上用欺诈证明，假设layer2中交易是真实的。</p>
<p>validium：每个区块结束之后都向主链发送初始和结束的状态根 + 有效性证明（零知识证明），智能合约去验证有效性证明，完成对layer2的一个信任，用户可以从主链的智能合约里面去提款了。</p>
<p>rollup :向主链发送的 是 <strong>区块状态根 + 压缩后的交易数据</strong> （安全性更高，但占用主链空间）</p>
<p>zk rollup : 用户直接通过主链智能合约提款</p>
</blockquote>
<p><img src="/images/layer2-sum/image-20230622102719216.png" srcset="/img/loading.gif" lazyload alt="image-20230622102719216"></p>
<p><img src="/images/layer2-sum/image-20230622104053148.png" srcset="/img/loading.gif" lazyload alt="image-20230622104053148"></p>
<blockquote>
<p><strong>将资金存入rollup</strong></p>
<ol>
<li>用户将资金存入layer1的智能合约</li>
<li>相应的在layer2链上创建对应的账户和余额，layer2中有很多账户，账户和余额组织成一颗默克尔树，得到root,保证账户余额不会被更改</li>
</ol>
<p><strong>交易</strong> ——中继者 coordinator</p>
<ol>
<li>用户创建交易，发送给中继者，中继者验证余额树，账户地址等等</li>
<li>中继者收到一定数量的交易，创建批处理，对ZK -proof电路编译一堆输入，得到证明（j交易树，merkel-proof）</li>
<li>上传到主链的rollup合约状态</li>
</ol>
</blockquote>
<p><img src="/images/layer2-sum/image-20230622104542137.png" srcset="/img/loading.gif" lazyload alt="image-20230622104542137"></p>
<p><img src="/images/layer2-sum/image-20230622110210365.png" srcset="/img/loading.gif" lazyload alt="image-20230622110210365"></p>
<blockquote>
<p>前状态根：更新之前的账户余额树，用账户的merkle证明检查发送者的正确性（zk 电路）</p>
<p>更新账户余额树：发送者的余额和随机数被改变，整个树根被改变（zk电路）</p>
<p>每次交易都会产生以上两个证明，每一次从更新的状态根中产生后续状态根证明</p>
</blockquote>
<p><img src="/images/layer2-sum/image-20230622110349902.png" srcset="/img/loading.gif" lazyload alt="image-20230622110349902"></p>
<blockquote>
<p>每个更新的状态根反映了每一次只有一件事发生变化。从发送者产生更新前的状态根，从接收者产生后续的状态根。</p>
<p><strong>电路遍历这个批次里的交易去创造更新后的链状态，产生最后的余额树状态根，为下一个区块的初始状态根。</strong></p>
<p>发送给Layer1上智能合约（数据 + 证明）前状态根和当前树匹配、验证中间状态根、后状态根，根据后状态根更新主链的状态、</p>
<p>取款（从layer2提款到主链）：用户将要提的资金数发送到余额树索引为0的账户，在layer2销毁资金，当这个交易被上传主链，主链智能合约将执行提款请求。</p>
</blockquote>
<p>zk rollup 不是只能执行交易，需要更加普适的功能，需要部署虚拟机，zk-VM，统一处理交易和智能合约的执行。如果zk-VM和EVM兼容，之前在以太坊上的应用很容易迁移到rollup上，但是目前还没有很好的解决。</p>
<p>兼容性体现在：共识层、字节码层、语言层（不懂）</p>
<blockquote>
<p>翻译EVM字节码，运行到zk-EVM上</p>
<p>翻译solidity语言</p>
</blockquote>
<p><img src="/images/layer2-sum/image-20230622144105314.png" srcset="/img/loading.gif" lazyload alt="image-20230622144105314"></p>
<h4 id="layer2痛点"><a href="#layer2痛点" class="headerlink" title="layer2痛点"></a>layer2痛点</h4><p><img src="/images/layer2-sum/image-20230622145415842.png" srcset="/img/loading.gif" lazyload alt="image-20230622145415842"></p>
<p><img src="/images/layer2-sum/image-20230622145659105.png" srcset="/img/loading.gif" lazyload alt="image-20230622145659105"></p>
<p>为EVM每个操作码设计zk电路？</p>
<p>佩德森承诺</p>
<p>zk-rollup主要瓶颈：零知识证明的生成速度，技术突破，，，</p>
<h2 id="零知识证明在币圈"><a href="#零知识证明在币圈" class="headerlink" title="零知识证明在币圈"></a>零知识证明在币圈</h2><p><img src="/images/layer2-sum/image-20230602144922178.png" srcset="/img/loading.gif" lazyload alt="image-20230602144922178"></p>
<p><img src="/images/layer2-sum/image-20230602145001327.png" srcset="/img/loading.gif" lazyload alt="image-20230602145001327"></p>
<p><img src="/images/layer2-sum/image-20230602145156549.png" srcset="/img/loading.gif" lazyload alt="image-20230602145156549"></p>
<p><img src="/images/layer2-sum/image-20230602145347083.png" srcset="/img/loading.gif" lazyload alt="image-20230602145347083"></p>
<p><img src="/images/layer2-sum/image-20230602145845986.png" srcset="/img/loading.gif" lazyload alt="image-20230602145845986"></p>
<p><img src="/images/layer2-sum/image-20230602150431099.png" srcset="/img/loading.gif" lazyload alt="image-20230602150431099"></p>
<p><img src="/images/layer2-sum/image-20230602150616688.png" srcset="/img/loading.gif" lazyload alt="image-20230602150616688"></p>
<p>What are the differences and connections between the following papers, what is researched, and what is the relationship with blockchain scaling, please analyze their core shortcomings and give suggestions for future research:</p>
<p>1.SlimChain: Scaling Blockchain Transactions through Off-Chain Storage and Parallel Processing</p>
<p>2.Ekiden: A Platform for Confidentiality-Preserving, Trustworthy, and Performant Smart Contracts</p>
<p>3.FASTKITTEN: Practical Smart Contracts on Bitcoin</p>
<p>4.POSE: Practical Off-chain Smart Contract Execution</p>
<p>5.Giving State to the Stateless: Augmenting Trustworthy Computation with Ledgers</p>
<h1 id="不完整的汇总指南"><a href="#不完整的汇总指南" class="headerlink" title="不完整的汇总指南"></a>不完整的汇总指南</h1><p>2021年1月5日<a target="_blank" rel="noopener" href="https://vitalik.ca/index.html">查看所有帖子</a></p>
<p><a target="_blank" rel="noopener" href="https://vitalik.ca/general/2021/01/05/rollup.html">https://vitalik.ca/general/2021/01/05/rollup.html</a></p>
<p>Rollup 在以太坊社区非常流行，并且在可预见的未来将<a target="_blank" rel="noopener" href="https://ethereum-magicians.org/t/a-rollup-centric-ethereum-roadmap/4698">成为</a>以太坊的关键可扩展性解决方案。但这项技术到底是什么？您对它有何期望？您将如何使用它？这篇文章将尝试回答其中一些关键问题。</p>
<h2 id="背景：什么是第-1-层和第-2-层缩放？"><a href="#背景：什么是第-1-层和第-2-层缩放？" class="headerlink" title="背景：什么是第 1 层和第 2 层缩放？"></a>背景：什么是第 1 层和第 2 层缩放？</h2><p><strong>有两种方法可以扩展区块链生态系统。首先，可以让区块链本身具有更高的交易能力</strong>。这项技术的主要挑战是，具有“更大区块”的区块链本质上更难以验证，并且可能变得更加中心化。为了避免此类风险，开发人员可以提高客户端软件的效率，或者更可持续地使用<a target="_blank" rel="noopener" href="https://eth.wiki/sharding/Sharding-FAQs">分片等</a>技术，将构建和验证链的工作分散到多个节点上；<a target="_blank" rel="noopener" href="https://ethereum.org/en/eth2">被称为“eth2”的项目</a>目前正在构建对以太坊的升级。</p>
<p><strong>其次，您可以改变使用区块链的方式</strong>。用户不是将<em>所有</em>活动直接放在区块链上，而是通过“第 2 层”协议在链外执行大部分活动。链上有一个智能合约，它只有两个任务：处理存款和取款，以及验证链下发生的一切都遵循规则的证据。进行这些证明的方法有多种，但它们都有一个共同的特点，即在链上验证证明比在链下进行原始计算要便宜得多。</p>
<h2 id="状态通道、等离子、汇总"><a href="#状态通道、等离子、汇总" class="headerlink" title="状态通道、等离子、汇总"></a>状态通道、等离子、汇总</h2><p>Layer-2 扩展的三种主要类型是<a target="_blank" rel="noopener" href="https://statechannels.org/">状态通道</a>、<a target="_blank" rel="noopener" href="http://plasma.io/">Plasma</a>和 Rollups。它们是三种不同的范式，具有不同的优点和缺点，在这一点上，我们相当有信心所有的第 2 层缩放都大致属于这三个类别（尽管边缘存在命名争议，例如参见“validium” <a target="_blank" rel="noopener" href="https://medium.com/starkware/volition-and-the-emerging-data-availability-spectrum-87e8bfa09bb">）</a>。</p>
<h3 id="渠道如何运作？"><a href="#渠道如何运作？" class="headerlink" title="渠道如何运作？"></a>渠道如何运作？</h3><p><em>另请参阅： https: <a target="_blank" rel="noopener" href="https://www.jeffcoleman.ca/state-channels">//www.jeffcoleman.ca/state-channels</a>和<a target="_blank" rel="noopener" href="https://statechannels.org/">statechannels.org</a></em></p>
<p>想象一下，Alice 向 Bob 提供互联网连接，作为交换，Bob 向她支付每兆字节 0.001 美元。Alice 和 Bob 使用以下第 2 层方案，而不是为每次付款进行交易。</p>
<p>首先，Bob 将 1 美元（或一些 ETH 或稳定币等价物）放入智能合约中。为了向 Alice 进行第一笔付款，Bob 签署了一张“票据”（一条链外消息），上面简单地写着“0.001 美元”，然后将其发送给 Alice。为了进行第二次付款，鲍勃将签署另一张写有“$0.002”的票据，并将其发送给爱丽丝。依此类推，根据需要支付尽可能多的款项。当爱丽丝和鲍勃完成交易时，爱丽丝可以将价值最高的票发布到链上，并包含在她自己的另一个签名中。智能合约验证爱丽丝和鲍勃的签名，向爱丽丝支付鲍勃票上的金额，并将其余部分返还给鲍勃。如果Alice不愿意关闭通道（由于恶意或技术故障），Bob可以启动提现期（例如7天）；如果 Alice 没有在该时间内提供票证，</p>
<p>这项技术非常强大：可以调整它来处理双向支付、智能合约关系（例如，Alice 和 Bob 在通道内制定金融合约）和组合（如果 Alice 和 Bob 有一个开放通道，Bob 和 Charlie 也有开放通道）爱丽丝可以与查理进行不信任的互动）。但渠道能做的事情是有限的。通道不能用于将资金从链下发送给还不是参与者的人。通道不能用于表示没有明确逻辑所有者的对象（例如 Uniswap）。而渠道，特别是如果用来做比简单的定期支付更复杂的事情，需要锁定大量资金。</p>
<h3 id="Plasma如何工作？"><a href="#Plasma如何工作？" class="headerlink" title="Plasma如何工作？"></a>Plasma如何工作？</h3><p><em>另请参阅：<a target="_blank" rel="noopener" href="http://plasma.io/plasma-deprecated.pdf">原始 Plasma 纸</a>和<a target="_blank" rel="noopener" href="https://ethresear.ch/t/plasma-cash-plasma-with-much-less-per-user-data-checking/1298">Plasma Cash</a>。</em></p>
<p>为了存入资产，用户将其发送到管理 Plasma 链的智能合约。美丽链链为该资产分配一个新的唯一 ID（例如 537）。每个 Plasma 链都有一个<em>运营商</em>（这可以是中心化参与者、多重签名，或者更复杂的东西，如 PoS 或 DPoS）。每个时间间隔（可以是 15 秒，或一小时，或介于两者之间的任何时间），操作员都会生成一个“批次”，其中包含他们在链下收到的所有 Plasma 交易。他们生成一棵 Merkle 树，其中在<code>X</code>树中的每个索引处，<code>X</code>如果存在这样的交易，则存在传输资产 ID 的交易，否则该叶子为零。他们将这棵树的 Merkle 根发布到链上。他们还发送每个索引的 Merkle 分支<code>X</code>该资产的当前所有者。要提取资产，用户需要发布向他们发送资产的最近交易的 Merkle 分支。合约开始一个挑战期，在此期间任何人都可以尝试使用其他 Merkle 分支，通过证明 (i) 发送者在发送资产时并不拥有该资产，或者 (ii) 他们发送了资产，从而使退出无效稍后的某个时间点给其他人。如果（例如）7天内没有人证明退出是欺诈性的，则用户可以提取资产。</p>
<p>Plasma 提供了比通道更强大的属性：您可以将资产发送给从未属于系统的参与者，并且资本要求要低得多。但这是有代价的：在“正常操作”期间，通道不需要任何数据就可以上链，但 Plasma 要求每个链定期发布一个哈希值。此外，Plasma 传输不是即时的：您必须等待间隔结束并发布区块。</p>
<p>此外，Plasma 和通道有一个共同的关键弱点：它们安全背后的博弈论依赖于这样的想法：两个系统控制的每个对象都有一些逻辑“所有者”。如果该所有者不关心他们的资产，则可能会导致涉及该资产的“无效”结果。这对于许多应用程序来说没问题，但对于许多其他应用程序（例如 Uniswap）来说却是一个问题。即使是在未经所有者同意的情况下可以更改对象状态的系统（例如基于帐户的系统，您可以在其中<em>增加</em>未经同意的某人的余额）不适用于 Plasma。这一切都意味着在任何现实的等离子或通道部署中都需要大量的“特定于应用程序的推理”，并且不可能制作仅模拟完整以太坊环境（或“EVM”）的等离子或通道系统。为了解决这个问题，我们需要……汇总。</p>
<h3 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h3><p><em>另请参阅：<a target="_blank" rel="noopener" href="https://docs.ethhub.io/ethereum-roadmap/layer-2-scaling/optimistic_rollups/">EthHub 关于乐观汇总</a>和<a target="_blank" rel="noopener" href="https://docs.ethhub.io/ethereum-roadmap/layer-2-scaling/zk-rollups/">ZK 汇总</a>。</em></p>
<p>Plasma 和通道是“完整”的第 2 层方案，因为它们试图将数据<em>和</em>计算移至链下。然而，<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=OJT_fR7wexw">围绕数据可用性的基本博弈论问题</a>意味着不可能对所有应用程序安全地执行此操作。Plasma 和通道通过依赖明确的所有者概念来解决这个问题，但这阻止了它们完全通用。另一方面，Rollup 是一种“混合”第 2 层方案。<strong>汇总将计算（和状态存储）移至链外，但将每个交易的一些数据保留在链上</strong>。为了提高效率，他们使用了一整套奇特的压缩技巧来用<em>计算代替数据</em>只要有可能。结果是系统的可扩展性仍然受到底层区块链数据带宽的限制，但比率非常有利：以太坊基础层 ERC20 代币传输成本约为 45000 Gas，而汇总中的 ERC20 代币传输需要 16字节的链上空间和低于 300 Gas 的成本。</p>
<p>数据在链上这一事实是关键（注意：将数据“放在 IPFS 上”是行不通的<em>，</em>因为 IPFS 无法就任何给定数据是否可用提供<em>共识；数据**必须</em>放在区块链上）。将数据放在链上并就这一事实达成共识，允许任何人在本地处理汇总中的所有操作（如果他们愿意），从而允许他们检测欺诈、发起提款或亲自开始生成交易批次。缺乏数据可用性问题意味着恶意或离线操作员可以做的事情<em>更少</em>危害（例如，它们不能导致 1 周的延迟），为有权发布批次的人开辟了更大的设计空间，并使汇总更容易推理。最重要的是，缺乏数据可用性问题意味着不再需要将资产映射到所有者，这就是以太坊社区对汇总比以前的第 2 层扩展形式更感兴趣的关键原因：汇总<strong>是完全通用，甚至可以在 rollup 中运行 EVM，从而允许现有的以太坊应用程序迁移到 rollup，几乎不需要编写任何新代码</strong>。</p>
<h2 id="好的，那么汇总到底是如何工作的呢？"><a href="#好的，那么汇总到底是如何工作的呢？" class="headerlink" title="好的，那么汇总到底是如何工作的呢？"></a>好的，那么汇总到底是如何工作的呢？</h2><p>链上有一个智能合约，它维护一个<strong>状态根</strong>：rollup 状态的 Merkle 根（意思是，在 rollup“内部”的账户余额、合约代码等）。</p>
<p><img src="https://vitalik.ca/images/rollup-files/diag1.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>任何人都可以发布一批<strong>，</strong>即高度压缩形式的交易集合以及先前的状态根和新的状态根（处理交易<em>后的Merkle 根）。</em>合约检查批次中的先前状态根是否与其当前状态根匹配；如果是，它将状态根切换到新的状态根。</p>
<p><img src="https://vitalik.ca/images/rollup-files/diag2.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>为了支持存款和取款，我们添加了输入或输出位于汇总状态“外部”的交易的功能。如果一个批次有来自外部的输入，则提交该批次的交易也需要将这些资产转移到汇总合约中。如果一个批次有输出到外部，那么在处理该批次时，智能合约将启动这些提款。</p>
<p>就是这样！除了一个主要细节：<strong>如何知道批次中的后状态根是否正确？</strong>如果有人可以提交具有任何后状态根的批次而不产生任何后果，他们可以将汇总内的所有代币转移给自己。这个问题很关键，因为该问题有两种截然不同的解决方案，而这两种解决方案导致了两种风格的汇总。</p>
<h3 id="乐观汇总-vs-ZK-汇总"><a href="#乐观汇总-vs-ZK-汇总" class="headerlink" title="乐观汇总 vs ZK 汇总"></a>乐观汇总 vs ZK 汇总</h3><p>两种类型的汇总是：</p>
<ol>
<li><strong>乐观汇总</strong>，使用<strong>欺诈证明</strong>：汇总合约跟踪其状态根的整个历史和每个批次的哈希值。如果有人发现某个批次的后状态根不正确，他们可以向链发布一个证明，证明该批次的计算不正确。合约验证证明，并恢复该批次及其之后的所有批次。</li>
<li><strong>ZK rollups</strong>，使用<strong>有效性证明</strong>：每个批次都包含一个称为 ZK-SNARK 的加密证明（例如使用<a target="_blank" rel="noopener" href="https://vitalik.ca/general/2019/09/22/plonk.html">PLONK</a>协议），它证明后状态根是执行该批次的正确结果。无论计算量有多大，证明都可以在链上很快得到验证。</li>
</ol>
<p>两种类型的汇总之间存在复杂的权衡：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">财产</th>
<th style="text-align:left">乐观汇总</th>
<th style="text-align:left">ZK 汇总</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">每批次固定气体成本</td>
<td style="text-align:left"><strong>~40,000</strong>（轻量级交易，主要只是改变状态根的值）</td>
<td style="text-align:left">~500,000（ZK-SNARK 的验证需要大量计算）</td>
</tr>
<tr>
<td style="text-align:left">停药期</td>
<td style="text-align:left">〜1周（提款需要延迟，以便有人有时间发布欺诈证明并在存在欺诈的情况下取消提款）</td>
<td style="text-align:left"><strong>非常快</strong>（只需等待下一批）</td>
</tr>
<tr>
<td style="text-align:left">技术的复杂性</td>
<td style="text-align:left"><strong>低的</strong></td>
<td style="text-align:left">高（ZK-SNARK 是非常新且数学复杂的技术）</td>
</tr>
<tr>
<td style="text-align:left">普遍性</td>
<td style="text-align:left"><strong>更容易</strong>（通用 EVM 汇总已经接近主网）</td>
<td style="text-align:left">更难（ZK-SNARK 证明通用 EVM 执行比证明简单计算要困难得多，尽管有一些努力（例如<a target="_blank" rel="noopener" href="https://medium.com/starkware/hello-cairo-3cb43b13b209">Cairo</a>）正在努力改进这一点）</td>
</tr>
<tr>
<td style="text-align:left">每笔交易的链上 Gas 成本</td>
<td style="text-align:left">更高</td>
<td style="text-align:left"><strong>较低</strong>（如果交易中的数据仅用于验证，而不是导致状态更改，则可以忽略该数据，而在乐观汇总中，需要将其发布，以防需要在欺诈证明中进行检查）</td>
</tr>
<tr>
<td style="text-align:left">链下计算成本</td>
<td style="text-align:left"><strong>更低</strong>（虽然更需要很多全节点重做计算）</td>
<td style="text-align:left">更高（ZK-SNARK 证明特别针对通用计算可能会很昂贵，可能比直接运行计算贵数千倍）</td>
</tr>
</tbody>
</table>
</div>
<p>总的来说，我自己的观点是，在短期内，乐观汇总可能会在通用 EVM 计算中胜出，而 ZK 汇总可能会在简单支付、交换和其他特定于应用程序的用例中胜出，但在随着 ZK-SNARK 技术的改进，中长期 ZK rollups 将在所有用例中胜出。</p>
<h3 id="欺诈证明剖析"><a href="#欺诈证明剖析" class="headerlink" title="欺诈证明剖析"></a>欺诈证明剖析</h3><p>乐观汇总的安全性取决于这样的想法：如果有人将无效批次发布到汇总中，那么<em>任何</em>跟上链并检测到欺诈行为的其他人都可以发布欺诈证明，向合约证明该批次是无效的，并且应该恢复。</p>
<p><img src="https://vitalik.ca/images/rollup-files/tree.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>声称批次无效的欺诈证据将包含绿色数据：批次本身（可以根据链上存储的哈希进行检查）以及 Merkle 树的部分需要证明仅读取的特定帐户和/或按批次修改。树中黄色的节点可以从绿色的节点重建，因此不需要提供。<a target="_blank" rel="noopener" href="https://ethresear.ch/t/the-stateless-client-concept/172">这些数据足以执行批处理并计算后状态根（请注意，这与无状态客户端</a>验证各个块的方式完全相同）。如果批次中计算的后状态根和提供的后状态根不相同，则该批次是欺诈的。</p>
<p>可以保证，如果一个批次构建不正确，<em>并且所有先前批次构建正确</em>，则可以创建一个欺诈证明，显示该批次构建不正确。请注意有关先前批次的声明：如果有多个无效批次发布到汇总，那么最好尝试证明最早的一批无效。当然，还可以保证，如果批次构建正确，则永远不可能创建表明该批次无效的欺诈证明。</p>
<h3 id="压缩是如何工作的？"><a href="#压缩是如何工作的？" class="headerlink" title="压缩是如何工作的？"></a>压缩是如何工作的？</h3><p>一个简单的以太坊交易（发送 ETH）大约需要 110 个字节。然而，一次 ETH 的汇总传输只需要大约 12 个字节：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">范围</th>
<th style="text-align:left">以太坊</th>
<th style="text-align:left">卷起</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">随机数</td>
<td style="text-align:left">〜3</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">天然气价格</td>
<td style="text-align:left">〜8</td>
<td style="text-align:left">0-0.5</td>
</tr>
<tr>
<td style="text-align:left">气体</td>
<td style="text-align:left">3</td>
<td style="text-align:left">0-0.5</td>
</tr>
<tr>
<td style="text-align:left">到</td>
<td style="text-align:left">21</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">价值</td>
<td style="text-align:left">〜9</td>
<td style="text-align:left">〜3</td>
</tr>
<tr>
<td style="text-align:left">签名</td>
<td style="text-align:left">~68 (2 + 33 + 33)</td>
<td style="text-align:left">～0.5</td>
</tr>
<tr>
<td style="text-align:left">从</td>
<td style="text-align:left">0（从 sig 恢复）</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">全部的</td>
<td style="text-align:left">〜112</td>
<td style="text-align:left">〜12</td>
</tr>
</tbody>
</table>
</div>
<p>部分原因在于卓越的编码：以太坊的 RLP 在每个值的长度上浪费了 1 个字节。但也有一些非常聪明的压缩技巧正在发生：</p>
<ul>
<li><strong>Nonce</strong>：该参数的目的是防止重放。如果帐户当前的随机数为 5，则该帐户的下一笔交易必须具有随机数 5，但一旦交易被处理，帐户中的随机数将增加到 6，因此无法再次处理该交易。在汇总中，我们可以完全省略随机数，因为我们只是从预状态恢复随机数；如果有人尝试使用较早的随机数重播交易，则签名将无法验证，因为将根据包含新的更高随机数的数据检查签名。</li>
<li><strong>Gasprice</strong>：我们可以允许用户以固定范围的gasprice 进行支付，例如。16 个连续的 2 的幂的选择。或者，我们可以在每个批次中设置固定的费用水平，甚至可以将天然气支付完全移出汇总协议，并让交易者通过通道向批次创建者支付费用。</li>
<li><strong>Gas</strong>：我们可以类似地将总 Gas 限制为 2 的连续幂的选择。或者，我们可以只在批次级别设置气体限制。</li>
<li><strong>To ：我们可以用*</strong>索引*替换 20 字节地址（例如，如果一个地址是添加到树中的第 4527 个地址，我们只需使用索引 4527 来引用它。我们会向状态添加一个子树来存储索引到地址的映射）。</li>
<li><strong>值</strong>：我们可以用科学记数法存储值。大多数情况下，传输只需要 1-3 位有效数字。</li>
<li><strong>签名</strong>：我们可以使用<a target="_blank" rel="noopener" href="https://ethresear.ch/t/pragmatic-signature-aggregation-with-bls/2105">BLS 聚合签名</a>，它允许将许多签名聚合为单个约 32-96 字节（取决于协议）的签名。然后可以一次性对照整组消息和发件人检查该签名。表中的 ~0.5 表示这样一个事实，即可以在单个块中验证的聚合中可以组合的签名数量是有限的，因此大批次每 ~100 个交易需要一个签名。</li>
</ul>
<p>ZK rollups 特有的一个重要压缩技巧是，如果交易的一部分仅用于验证，与计算状态更新无关，那么该部分可以留在链外。这无法在乐观汇总中完成，因为该数据仍然需要包含在链上，以防稍后需要在欺诈证明中进行检查，而在 ZK 汇总中，证明批次正确性的 SNARK 已经证明了任何数据提供了验证所需的信息。一个重要的例子是隐私保护汇总：在乐观汇总中，每笔交易中用于隐私的约 500 字节 ZK-SNARK 需要上链，而在 ZK 汇总中，覆盖整个批次的 ZK-SNARK 已经没有留下任何痕迹。怀疑“内部”ZK-SNARK 是否有效。</p>
<p>这些压缩技巧是汇总可扩展性的关键；如果没有它们，汇总可能只会使基础链的可扩展性提高约 10 倍（尽管有一些特定的计算量大的应用程序，即使简单的汇总也很强大），而使用压缩技巧，缩放因子几乎可以超过 100 倍所有应用程序。</p>
<h3 id="谁可以提交一批？"><a href="#谁可以提交一批？" class="headerlink" title="谁可以提交一批？"></a>谁可以提交一批？</h3><p>对于谁可以在 optimistic 或 ZK rollup 中提交批次，有很多想法。一般来说，大家都同意，为了能够提交一批，用户必须缴纳大量押金；如果该用户提交了欺诈性批次（例如，具有无效的状态根），则该存款将被部分销毁，部分作为欺诈证明者的奖励。但除此之外，还有很多可能性：</p>
<ul>
<li><strong>完全无政府状态</strong>：任何人都可以随时提交批次。这是最简单的方法，但它有一些重要的缺点。特别是，存在这样的风险：多个参与者将生成并尝试并行提交批次，并且只有其中一个批次可以成功包含在内。这会导致在生成证明方面浪费大量精力和/或在将批次发布到链上时浪费气体。</li>
<li><strong>集中式排序器</strong>：有一个参与者，<strong>排序器</strong>，可以提交批次（提款除外：通常的技术是用户可以首先提交提款请求，然后如果排序器在下一个中不处理该提款请求批量，则用户可以自己提交单操作批量）。这是最“高效”的，但它依赖于中心参与者的活跃度。</li>
<li><strong>定序器拍卖</strong>：举行拍卖（例如每天）以确定谁有权成为第二天的定序器。该技术的优点是它筹集了可以通过例如分配的资金。由 rollup 控制的 DAO（参见：<a target="_blank" rel="noopener" href="https://ethresear.ch/t/mev-auction-auctioning-transaction-ordering-rights-as-a-solution-to-miner-extractable-value/6788">MEV 拍卖</a>）</li>
<li><strong>PoS 集合中的随机选择</strong>：任何人都可以将 ETH（或者可能是 rollup 自己的协议代币）存入 rollup 合约中，每一批的排序者都是从存款人中随机选择的，被选中的概率与金额成正比存入。这种技术的主要缺点是它会导致大量不必要的资金锁定。</li>
<li><strong>DPoS 投票</strong>：通过拍卖选择一个排序器，但如果它们表现不佳，代币持有者可以投票将其踢出并举行新的拍卖来取代它们。</li>
</ul>
<h4 id="拆分批处理和状态根提供"><a href="#拆分批处理和状态根提供" class="headerlink" title="拆分批处理和状态根提供"></a>拆分批处理和状态根提供</h4><p>目前正在开发的一些汇总正在使用“拆分批次”范例，其中提交一批第 2 层交易的操作和提交状态根的操作是分开完成的。这有一些关键的优点：</p>
<ol>
<li>您可以允许许多定序器并行发布批次，以提高审查阻力，而不必担心某些批次会因为其他批次首先被包含而无效。</li>
<li>如果状态根是欺诈性的，您不需要恢复整个批次；您可以仅恢复状态根，然后等待某人为同一批提供新的状态根。这为交易发送者提供了更好的保证，他们的交易不会被还原。</li>
</ol>
<p>总而言之，有一个相当复杂的技术动物园，试图在涉及效率、简单性、审查制度阻力和其他目标的复杂权衡之间取得平衡。现在说这些想法的哪种组合最有效还为时过早。时间会证明一切。</p>
<h2 id="汇总可以为您提供多少缩放？"><a href="#汇总可以为您提供多少缩放？" class="headerlink" title="汇总可以为您提供多少缩放？"></a>汇总可以为您提供多少缩放？</h2><p>在现有的以太坊链上，Gas上限为1250万，一笔交易中的每个字节数据需要花费16个Gas。这意味着，如果一个块只包含单个批次（我们会说使用了 ZK rollup，在证明验证上花费了 500k 气体），则该批次可以包含 (1200 万 / 16) = 750,000 字节的数据。如上所示，ETH 传输的汇总每个用户操作仅需要 12 个字节，这意味着该批次最多可以包含 62,500 个交易。<a target="_blank" rel="noopener" href="https://etherscan.io/chart/blocktime">以13 秒</a>的平均出块时间计算，这相当于约 4807 TPS（相比之下，直接在以太坊本身上进行 ETH 传输的 1250 万/21000 / 13 ~= 45 TPS）。</p>
<p>下面是一些其他示例用例的图表：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">应用</th>
<th style="text-align:left">汇总中的字节数</th>
<th style="text-align:left">第 1 层的 Gas 成本</th>
<th style="text-align:left">最大可扩展性增益</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">以太坊转账</td>
<td style="text-align:left"><strong>12</strong></td>
<td style="text-align:left">21,000</td>
<td style="text-align:left">105倍</td>
</tr>
<tr>
<td style="text-align:left">ERC20转账</td>
<td style="text-align:left"><strong>16</strong>（另外 4 个字节来指定哪个令牌）</td>
<td style="text-align:left">〜50,000</td>
<td style="text-align:left">187x</td>
</tr>
<tr>
<td style="text-align:left">Uniswap 交易</td>
<td style="text-align:left"><strong>~14</strong>（4 字节发送者 + 4 字节接收者 + 3 字节值 + 1 字节最高价格 + 1 字节杂项）</td>
<td style="text-align:left">〜100,000</td>
<td style="text-align:left">428x</td>
</tr>
<tr>
<td style="text-align:left">隐私保护提现（乐观汇总）</td>
<td style="text-align:left"><strong>296</strong>（4字节根索引+32字节无效符+4字节接收者+256字节ZK-SNARK证明）</td>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://etherscan.io/tx/0x6e311f84655af72614966705584569b52d6e314f2d61b965db91db41fd01b1e1">〜380,000</a></td>
<td style="text-align:left">77x</td>
</tr>
<tr>
<td style="text-align:left">隐私保护提现（ZK rollup）</td>
<td style="text-align:left"><strong>40</strong>（4字节根索引+32字节无效符+4字节接收者）</td>
<td style="text-align:left"><a target="_blank" rel="noopener" href="https://etherscan.io/tx/0x6e311f84655af72614966705584569b52d6e314f2d61b965db91db41fd01b1e1">〜380,000</a></td>
<td style="text-align:left">570x</td>
</tr>
</tbody>
</table>
</div>
<p><em>最大可扩展性增益的计算公式为（L1 Gas 成本）/（汇总字节数 \</em> 16）* 1200 万/1250 万。*</p>
<p>现在，值得记住的是，由于一些原因，这些数字过于乐观。最重要的是，一个块几乎永远不会只包含一批，至少因为存在并且将会有多个汇总。其次，存款和取款将继续存在。第三，<em>短期内</em>使用率较低，因此固定成本将占主导地位。但即使考虑到这些因素，超过 100 倍的可扩展性增益预计也将成为常态。</p>
<p>现在，如果我们想要超过 ~1000-4000 TPS（取决于具体用例）怎么办？这就是<a target="_blank" rel="noopener" href="https://hackmd.io/@HWeNw8hNRimMm2m2GH56Cw/sharding_proposal">eth2数据分片</a>的用武之地。分片提案每12秒开辟一个16MB的空间，可以填充任何数据，并且系统保证对该数据的可用性达成共识。该数据空间可供汇总使用。每秒约 1398k 字节是现有以太坊链约 60 kB/秒的 23 倍，从长远来看，数据容量预计将进一步增长。因此，使用 eth2 分片数据的汇总可以总共处理高达约 100k TPS，并且在未来甚至更多。</p>
<h2 id="Rollup-中还有哪些尚未完全解决的挑战？"><a href="#Rollup-中还有哪些尚未完全解决的挑战？" class="headerlink" title="Rollup 中还有哪些尚未完全解决的挑战？"></a>Rollup 中还有哪些尚未完全解决的挑战？</h2><p>虽然 Rollup 的基本概念现在已经很好理解，但我们非常确定它们从根本上来说是可行和安全的，并且多个 Rollup 已经部署到主网上，但仍有许多 Rollup 设计领域尚未得到很好的探索，将以太坊生态系统的大部分内容完全引入 Rollups 以利用其可扩展性方面面临着相当多的挑战。一些关键挑战包括：</p>
<ul>
<li><strong>用户和生态系统入门</strong>——没有多少应用程序使用 Rollup，用户对 Rollup 不熟悉，并且很少有钱包开始集成 Rollup。商家和慈善机构尚未接受它们付款。</li>
<li><strong>交叉汇总交易</strong>——有效地将资产和数据（例如预言机输出）从一个汇总转移到另一个汇总，而不会产生通过基础层的费用。</li>
<li><strong>审计激励措施</strong>- 如何最大限度地提高至少一个诚实节点实际上完全验证乐观汇总的机会，以便在出现问题时他们可以发布欺诈证明？对于小规模的汇总（最多几百 TPS），这不是一个重要问题，人们可以简单地依赖利他主义，但对于更大规模的汇总，需要对此进行更明确的推理。</li>
<li><strong>探索等离子和汇总之间的设计空间</strong>- 是否有技术可以将<em>一些</em>与状态更新相关的数据放在链上，但不是<em>全部</em>，以及从中可以得出什么有用的东西？</li>
<li><strong>最大限度地提高预确认的安全性</strong>- 许多汇总提供了“预确认”的概念以实现更快的用户体验，其中定序器立即提供交易将包含在下一批中的承诺，并且如果定序器违反了其保证金，则定序器的押金将被销毁。单词。但该方案的经济安全性是有限的，因为有可能同时向很多参与者做出许多承诺。这个机制可以改进吗？</li>
<li><strong>提高对缺失定序器的响应速度</strong>- 如果汇总的定序器突然离线，则尽可能快速且廉价地从该情况中恢复是有价值的，要么快速且廉价地批量退出到不同的汇总，要么更换定序器。</li>
<li><strong>高效的 ZK-VM</strong> - 生成 ZK-SNARK 证明，证明通用 EVM 代码（或现有智能合约可以编译到的某些不同 VM）已正确执行并具有给定结果。</li>
</ul>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>Rollup 是一种强大的新的第 2 层扩展范例，预计将成为以太坊在短期和中期（也可能是长期）扩展的基石。他们看到了以太坊社区的大量兴奋，因为与之前的第 2 层扩展尝试不同，它们可以支持通用 EVM 代码，允许现有应用程序轻松迁移。他们通过做出一个关键的妥协来做到这一点：不尝试完全脱离链，而是将每笔交易的少量数据留在链上。</p>
<p>汇总有很多种，设计空间也有多种选择：可以使用欺诈证明进行乐观汇总，也可以使用有效性证明进行 ZK 汇总（又名 ZK-SNARK）。定序器（可以将交易批次发布到链上的用户）可以是中心化参与者，也可以是混战者，或者介于两者之间的许多其他选择。Rollup 仍然是一项早期技术，开发仍在快速进行，但它们确实有效，其中一些（特别是<a target="_blank" rel="noopener" href="https://loopring.io/">Loopring</a>、<a target="_blank" rel="noopener" href="https://wallet.zksync.io/">ZKSync</a>和<a target="_blank" rel="noopener" href="https://www.deversifi.com/">DeversiFi</a>）已经运行了几个月。预计未来几年将会有更多令人兴奋的工作从汇总空间中诞生。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/blockchain/" class="category-chain-item">blockchain</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/summary/">#summary</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>layer2_sum</div>
      <div>https://yuwxl.github.io/2023/04/25/layer2-sum/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>nayun</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/05/15/Ethereum-Graph-Analysis/" title="Ethereum_Graph_Analysis">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Ethereum_Graph_Analysis</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/04/24/Ethereum/" title="Ethereum">
                        <span class="hidden-mobile">Ethereum</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
